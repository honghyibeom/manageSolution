<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>회원 CARE</title>
    <style>
        /* 컨테이너 카드 */
        .table-container {
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 20px;
            height: 100%;
        }

        /* 제목 */
        .table-title {
            font-weight: 600;
            font-size: 1.2rem;
        }
        .table-description {
            font-size: 0.85rem;
            color: #6c757d;
        }

        /* 스크롤 테이블 */
        .scroll-table {
            height: 500px;
            max-height: 500px;
            overflow-y: auto;
        }
        .scroll-table::-webkit-scrollbar {
            width: 6px;
        }
        .scroll-table::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        /* 테이블 커스텀 */
        .table-custom thead {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            font-weight: 600;
        }
        .table-custom tbody tr:hover {
            background-color: #f6faff;
            transition: 0.2s;
        }

        /* 모바일 카드뷰 */
        .card-mobile .card {
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        .card-mobile .badge {
            font-size: 0.8rem;
            padding: 0.4em 0.6em;
        }

        /* 반응형 처리 */
        @media (max-width: 768px) {
            .scroll-table { display: none; }   /* 모바일에서는 테이블 숨김 */
            .card-mobile { display: block; }
        }
        @media (min-width: 769px) {
            .card-mobile { display: none; }   /* 데스크탑에서는 카드 숨김 */
        }
    </style>
    <!-- Bootstrap 아이콘 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<main layout:fragment="content">
    <div class="container-fluid py-4">
        <h4 class="fw-bold mb-4"><i class="bi bi-people me-2"></i>회원 CARE</h4>

        <!-- 검색 영역 -->
        <form class="d-flex align-items-center gap-2 mb-4" th:action="@{/care}" method="get">
            <input type="text" class="form-control" name="keyword"
                   placeholder="이름 또는 전화번호를 입력하세요."
                   th:value="${keyword}" style="width: 300px;" />
            <button type="submit" class="btn btn-outline-secondary">
                <i class="bi bi-search"></i> 검색
            </button>
        </form>

        <div class="row g-4">
            <!-- 첫 수업 CARE -->
            <div class="col-md-6">
                <div class="table-container">
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-heart-pulse text-danger me-2"></i>
                        <span class="table-title">첫 수업 CARE</span>
                    </div>
                    <p class="table-description">🩺 첫 수업을 예약한 회원님들입니다.</p>

                    <!-- 데스크탑 테이블 -->
                    <div class="scroll-table">
                        <table class="table table-bordered text-center align-middle table-custom">
                            <thead>
                            <tr>
                                <th>이름</th>
                                <th>연락처</th>
                                <th>회차</th>
                                <th>총 횟수</th>
                                <th>예약일자</th>
                                <th>예약시간</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="pt : ${ptMembers}">
                                <td th:text="${pt.memberName}"></td>
                                <td th:text="${pt.memberPhone}"></td>
                                <td th:text="${pt.count}"></td>
                                <td th:text="${pt.totalCount}"></td>
                                <td th:text="${#temporals.format(pt.sessionDate, 'yyyy-MM-dd')}"></td>
                                <td th:text="${#temporals.format(pt.sessionTime, 'HH:mm')}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 모바일 카드 -->
                    <div class="card-mobile">
                        <div th:each="pt : ${ptMembers}" class="card shadow-sm mb-2 p-3">
                            <div class="fw-bold" th:text="${pt.memberName}"></div>
                            <div class="text-muted small" th:text="${pt.memberPhone}"></div>
                            <div class="mt-2">
                                <span class="badge bg-info">
                                    회차 [[${pt.count}]] / 총 [[${pt.totalCount}]]
                                </span>
                            </div>
                            <div class="mt-2 small text-muted">
                                [[${#temporals.format(pt.sessionDate, 'yyyy-MM-dd')}]]
                                [[${#temporals.format(pt.sessionTime, 'HH:mm')}]]
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 마감 CARE -->
            <div class="col-md-6">
                <div class="table-container">
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-calendar-event text-primary me-2"></i>
                        <span class="table-title">마감 CARE</span>
                    </div>
                    <p class="table-description">📆 마감 임박한 회원님들입니다.</p>

                    <!-- 데스크탑 테이블 -->
                    <div class="scroll-table">
                        <table class="table table-bordered text-center align-middle table-custom">
                            <thead>
                            <tr>
                                <th>이름</th>
                                <th>연락처</th>
                                <th>상품명</th>
                                <th>잔여횟수</th>
                                <th>종료일</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="membership : ${membershipMembers}">
                                <td th:text="${membership.memberName}"></td>
                                <td th:text="${membership.phone}"></td>
                                <td th:text="${membership.productName}"></td>
                                <td>
                                    <!-- 잔여횟수 조건부 -->
                                    <span class="badge bg-danger"
                                          th:if="${membership.remainingCount != null and membership.remainingCount != '-' and T(Integer).parseInt(membership.remainingCount) <= 3}"
                                          th:text="'잔여 ' + ${membership.remainingCount}">
                                        </span>
                                    <span class="badge bg-success"
                                          th:if="${membership.remainingCount != null and membership.remainingCount != '-' and T(Integer).parseInt(membership.remainingCount) > 3}"
                                          th:text="'잔여 ' + ${membership.remainingCount}">
                                        </span>
                                    <span class="badge bg-secondary"
                                          th:if="${membership.remainingCount == '-'}"
                                          th:text="${membership.remainingCount}">
                                        </span>
                                </td>
                                <td th:text="${#temporals.format(membership.endDate, 'yyyy-MM-dd')}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 모바일 카드 -->
                    <div class="card-mobile">
                        <div th:each="membership : ${membershipMembers}" class="card shadow-sm mb-2 p-3">
                            <div class="fw-bold" th:text="${membership.memberName}"></div>
                            <div class="text-muted small" th:text="${membership.phone}"></div>
                            <div class="mt-2">
                                <span class="badge bg-secondary" th:text="${membership.productName}"></span>
                            </div>
                            <div class="mt-2">
                                <!-- 잔여횟수 조건부 -->
                                <span class="badge bg-danger"
                                      th:if="${membership.remainingCount != null and membership.remainingCount != '-' and T(Integer).parseInt(membership.remainingCount) <= 3}"
                                      th:text="'잔여 ' + ${membership.remainingCount}">
                                </span>
                                <span class="badge bg-success"
                                      th:if="${membership.remainingCount != null and membership.remainingCount != '-' and T(Integer).parseInt(membership.remainingCount) > 3}"
                                      th:text="'잔여 ' + ${membership.remainingCount}">
                                </span>
                                <span class="badge bg-secondary"
                                      th:if="${membership.remainingCount == '-'}"
                                      th:text="${membership.remainingCount}">
                                </span>
                            </div>
                            <div class="mt-2 small text-muted">
                                종료일: [[${#temporals.format(membership.endDate, 'yyyy-MM-dd')}]]
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
</html>
