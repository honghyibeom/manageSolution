<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>통계</title>
    <style>
        .no-bg {
            background-color: transparent !important;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<main layout:fragment="content">
    <div class ="container">
        <h4 class="fw-bold mb-4">매출 현황</h4>

    <p class="mb-4 fw-bold" th:text="${today} + ' 기준 매출현황입니다.'">
        yyyy년 MM월 dd일
    </p>
        <div class="row g-3 mb-4 p-3 rounded " style="background:#e6f7ff">
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm text-dark">
                    <div class="card-body">
                        <h6 class="card-title text-muted">총 매출</h6>
                        <h5 class="fw-bold" th:text="${totalSales}">334,197,202원</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm text-dark">
                    <div class="card-body">
                        <h6 class="card-title text-muted">월 매출</h6>
                        <h5 class="fw-bold" th:text="${monthlySales}">11,924,500원</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm text-dark">
                    <div class="card-body">
                        <h6 class="card-title text-muted">일 매출</h6>
                        <h5 class="fw-bold" th:text="${dailySales}">0원</h5>
                    </div>
                </div>
            </div>
        </div>

        <div class="p-3 mb-3 bg-light rounded border d-flex align-items-center gap-2 justify-content-between">
            <div class="d-flex align-items-center gap-2">
                <label class="fw-bold mb-0 mr-2">기간조회</label>
                <input type="date" class="form-control form-control-sm w-auto" id="startDate">
                <span>~</span>
                <input type="date" class="form-control form-control-sm w-auto" id="endDate">
            </div>

            <div class="btn-group" role="group">
                <a th:href="@{/products(type='ALL')}"
                   class="btn"
                   th:classappend="${type == 'ALL'} ? 'btn-primary' : 'btn-outline-secondary'">
                    년
                </a>
                <a th:href="@{/products(type='MEMBERSHIP')}"
                   class="btn"
                   th:classappend="${type == 'MEMBERSHIP'} ? 'btn-primary' : 'btn-outline-secondary'">
                    월
                </a>
                <a th:href="@{/products(type='PT')}"
                   class="btn"
                   th:classappend="${type == 'PT'} ? 'btn-primary' : 'btn-outline-secondary'">
                    일
                </a>
            </div>
        </div>


        <div class="container m-4">
            <canvas id="salesChart" width="300" height="100"></canvas>
        </div>

        <div class="row gx-4">
            <div class="col-12 col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header fw-bold text-center">
                        PT권 통계
                    </div>

                    <div class="card-body fixed-height">
                        <div class="scroll-table">
                            <table class="table table-bordered text-center align-middle mb-0">
                                <thead class="table-light">
                                <tr>
                                    <th>회원명</th>
                                    <th>횟수</th>
                                    <th>금액</th>
                                    <th>날짜</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="member : ${ptMembers}">
                                    <td th:text="${member.memberName}"></td>
                                    <td th:text="${member.count}"></td>
                                    <td th:text="${member.price}"></td>
                                    <td th:text="${#temporals.format(member.date, 'yyyy-MM-dd')}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ✅ 합계 박스 -->
                <div class="bg-dark text-white text-center py-2 rounded mt-3 mb-3">
                    총합: <span>2,516,000원</span> / 총 건수: <span>15개</span>
                </div>

            </div>

            <!-- 오른쪽: 회원권 회원 -->
            <div class="col-12 col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header fw-bold text-center">
                        <span>회원권 통계</span>
                    </div>

                    <div class="card-body fixed-height">
                        <div class="scroll-table">
                            <table class="table table-bordered text-center align-middle mb-0">
                                <thead class="table-light">
                                <tr>
                                    <th>이름</th>
                                    <th>상품명</th>
                                    <th>금액</th>
                                    <th>날짜</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="member : ${membershipMembers}">
                                    <td th:text="${member.memberName}"></td>
                                    <td th:text="${member.productName}"></td>
                                    <td th:text="${member.price}"></td>
                                    <td th:text="${#temporals.format(member.date, 'yyyy-MM-dd')}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ✅ 합계 박스 -->
                <div class="bg-dark text-white text-center py-2 rounded mt-3 mb-3">
                    총합: <span>2,516,000원</span> / 총 건수: <span>15개</span>
                </div>

            </div>
        </div>
    </div>

    <script th:inline="javascript">
        const labels = /*[[${labels}]]*/ [];
        const sales = /*[[${sales}]]*/ [];

        console.log("labels:", labels);
        console.log("sales:", sales);

        const ctx = document.getElementById('salesChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: '월별 매출',
                    data: sales,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>

</main>
</body>
</html>
