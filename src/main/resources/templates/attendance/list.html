<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>ì¶œì„ ë¦¬í¬íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ë°˜ì‘í˜• */
        @media (max-width: 991.98px) {
            .table-desktop { display: none; }
            .card-mobile { display: block; }
        }
        @media (min-width: 992px) {
            .table-desktop { display: block; }
            .card-mobile { display: none; }
        }

        /* ë²„íŠ¼ & ë°°ì§€ */
        .btn-primary {
            background: #42a5f5; /* ì¢€ ë” ì—°í•œ í•˜ëŠ˜ìƒ‰ */
            border: none;
        }
        .btn-outline-primary {
            border-color: #42a5f5;
            color: #42a5f5;
        }
        .btn-outline-primary:hover {
            background: #42a5f5;
            color: #fff;
        }
        .badge.bg-success { background-color: #4caf50 !important; }
        .badge.bg-danger { background-color: #ef5350 !important; }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }
        .card-header {
            background: #f5f9ff;
            border-bottom: 1px solid #e0e0e0;
            font-weight: bold;
        }
        .card.shadow-sm:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.06);
        }

        /* í…Œì´ë¸” */
        .table thead {
            background: #f1f5fb;
        }
        .table-hover tbody tr:hover {
            background: #f9fbff;
        }

        /* ëª¨ë°”ì¼ ì¹´ë“œ */
        .card-mobile .card {
            border-left: 4px solid #42a5f5;
        }
        .card-mobile .card-body h6 {
            color: #333;
        }

        /* ì°¨íŠ¸ ë†’ì´ */
        canvas {
            max-height: 280px;
        }
    </style>
</head>

<main layout:fragment="content">
    <div class="container">
        <!-- í˜ì´ì§€ ì œëª© -->
        <div class="d-flex align-items-center mb-4">
            <i class="bi bi-clipboard-check text-primary fs-3 me-2"></i>
            <h4 class="fw-bold mb-0">ì¶œì„ ë¦¬í¬íŠ¸</h4>
        </div>

        <!-- ğŸ“… ê¸°ê°„ í•„í„° -->
        <div class="row mb-4">
            <div class="col-12">
                <form method="get" class="d-flex justify-content-between align-items-center gap-3 flex-wrap">
                    <div class="d-flex align-items-center gap-2">
                        <label class="form-label mb-0 fw-bold text-secondary">ê¸°ê°„</label>
                        <input type="date" name="startDate" th:value="${param.startDate}"
                               class="form-control form-control-sm" style="width:auto;">
                        ~
                        <input type="date" name="endDate" th:value="${param.endDate}"
                               class="form-control form-control-sm" style="width:auto;">
                        <button type="submit" class="btn btn-sm btn-primary">ì¡°íšŒ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ğŸ” íšŒì›ë³„ ì¶œì„ í˜„í™© -->
        <div class="card shadow-sm mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-people me-2"></i> íšŒì›ë³„ ì¶œì„ í˜„í™©</span>
                <form class="d-flex" style="max-width: 200px;">
                    <input type="text" class="form-control form-control-sm me-2" placeholder="íšŒì›ëª… ê²€ìƒ‰">
                    <button type="submit" class="btn btn-sm btn-outline-primary">ê²€ìƒ‰</button>
                </form>
            </div>
            <div class="card-body">
                <div class="table-responsive table-desktop">
                    <table class="table table-bordered table-hover text-center align-middle">
                        <thead>
                        <tr>
                            <th>ë‚ ì§œ</th>
                            <th>ì‹œê°„</th>
                            <th>íšŒì›ëª…</th>
                            <th>ê°•ì‚¬</th>
                            <th>ìƒí’ˆ</th>
                            <th>ìƒíƒœ</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="report : ${reportList}">
                            <td th:text="${report.sessionDate}">2025-09-01</td>
                            <td th:text="${report.sessionTime}">09:00</td>
                            <td th:text="${report.memberName}">ê¹€ì² ìˆ˜</td>
                            <td th:text="${report.trainerName}">í™ê¸¸ë™</td>
                            <td th:text="${report.productName}">10íšŒ PT</td>
                            <td>
                                <span th:classappend="${report.status == 'ì¶œì„'} ? 'badge bg-success' : 'badge bg-danger'"
                                      th:text="${report.status}">ì¶œì„</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ëª¨ë°”ì¼ ì¹´ë“œ ë·° -->
                <div class="card-mobile">
                    <div class="card mb-2 shadow-sm" th:each="report : ${reportList}">
                        <div class="card-body">
                            <h6 class="fw-bold">
                                <span th:text="${report.memberName}">ê¹€ì² ìˆ˜</span>
                                <span th:classappend="${report.status == 'ì¶œì„'} ? 'badge bg-success' : 'badge bg-danger'"
                                      th:text="${report.status}">ì¶œì„</span>
                            </h6>
                            <p class="mb-1">
                                <i class="bi bi-calendar-event me-1"></i>
                                <span th:text="${report.sessionDate}">2025-09-01</span> (<span th:text="${report.sessionTime}">09:00</span>)
                            </p>
                            <p class="mb-1"><i class="bi bi-person-badge me-1"></i> ê°•ì‚¬: <span th:text="${report.trainerName}">í™ê¸¸ë™</span></p>
                            <p class="mb-0"><i class="bi bi-box-seam me-1"></i> ìƒí’ˆ: <span th:text="${report.productName}">10íšŒ PT</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ğŸ“Š ì°¨íŠ¸ -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header"><i class="bi bi-calendar3-week me-2"></i> ìš”ì¼ë³„ ì¶œì„ í˜„í™©</div>
                    <div class="card-body"><canvas id="weeklyChart"></canvas></div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header"><i class="bi bi-clock-history me-2"></i> ì‹œê°„ëŒ€ë³„ ì¶œì„ í˜„í™©</div>
                    <div class="card-body"><canvas id="timeChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- ğŸš¨ íœ´ë©´ íšŒì› -->
        <div class="card shadow-sm mb-4">
            <div class="card-header text-danger">
                <i class="bi bi-exclamation-triangle me-2"></i> íœ´ë©´ íšŒì› (ìµœê·¼ 1ê°œì›” ì´ìƒ ë¯¸ì¶œì„)
            </div>
            <div class="card-body">
                <div class="table-responsive table-desktop">
                    <table class="table table-bordered table-hover text-center align-middle">
                        <thead>
                        <tr>
                            <th>íšŒì›ëª…</th>
                            <th>ì „í™”ë²ˆí˜¸</th>
                            <th>ë§ˆì§€ë§‰ ì¶œì„ì¼</th>
                            <th>ë³´ìœ  ìƒí’ˆ</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="dormant : ${dormantList}">
                            <td th:text="${dormant.memberName}">ë°•ë¯¼ìˆ˜</td>
                            <td th:text="${dormant.phone}">010-5555-6666</td>
                            <td th:text="${dormant.lastAttendanceDate}">2025-07-10</td>
                            <td th:text="${dormant.productName}">20íšŒ PT</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <!-- ëª¨ë°”ì¼ ì¹´ë“œ -->
                <div class="card-mobile">
                    <div class="card mb-2 border-danger shadow-sm">
                        <div class="card-body">
                            <h6 class="fw-bold text-danger">ë°•ë¯¼ìˆ˜</h6>
                            <p class="mb-1"><i class="bi bi-phone me-1"></i> 010-5555-6666</p>
                            <p class="mb-1"><i class="bi bi-calendar-x me-1"></i> ë§ˆì§€ë§‰ ì¶œì„: 2025-07-10</p>
                            <p class="mb-0"><i class="bi bi-box-seam me-1"></i> ìƒí’ˆ: 20íšŒ PT</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… Chart.js -->
    <script th:inline="javascript">
        const chartData = [[${chartData}]]; // { weekly: [...], time: [...] }

        new Chart(document.getElementById('weeklyChart'), {
            type: 'bar',
            data: {
                labels: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'],
                datasets: [{ data: chartData.weekly, backgroundColor: '#42a5f5' }]
            },
            options: { plugins: { legend: { display: false } }, responsive: true }
        });

        new Chart(document.getElementById('timeChart'), {
            type: 'line',
            data: {
                labels: ['06ì‹œ', '09ì‹œ', '12ì‹œ', '15ì‹œ', '18ì‹œ', '21ì‹œ'],
                datasets: [{
                    data: chartData.time,
                    borderColor: '#ef5350',
                    backgroundColor: 'rgba(239,83,80,0.2)',
                    fill: true, tension: 0.3
                }]
            },
            options: { plugins: { legend: { display: false } }, responsive: true }
        });
    </script>
</main>
</html>
