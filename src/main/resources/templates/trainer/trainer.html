<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Í∞ïÏÇ¨ Í¥ÄÎ¶¨</title>
    <style>
        /* ======================== Í≥µÌÜµ ======================== */
        .scroll-table {
            max-height: 500px;
            overflow-y: auto;
        }

        .clickable-row { cursor: pointer; }
        .clickable-row:hover { background-color: #f8f9fa; }

        /* Ïπ¥Îìú hover Ìö®Í≥º */
        .card {
            border-radius: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.08);
        }

        /* Ïπ¥Îìú ÎÇ¥Î∂Ä ÌÖçÏä§Ìä∏ Í∞ÑÍ≤© */
        .card-body p {
            margin-bottom: 0.5rem;
        }

        /* Î™®Î∞îÏùº Ï†ÑÌôò */
        @media (max-width: 991.98px) {
            .table-desktop { display: none; }
            .card-mobile { display: block; }
        }
        @media (min-width: 992px) {
            .card-mobile { display: none; }
        }

        /* ======================== Í∞ïÏÇ¨ Î™©Î°ù ======================== */
        .trainer-card h5 {
            font-weight: 700;
        }
        .trainer-card .fw-bold.text-primary {
            font-size: 0.95rem;
        }

        /* ======================== ÌöåÏõê Î™©Î°ù ======================== */
        .member-card h6 {
            font-weight: 600;
            color: #333;
        }
        .member-card p {
            font-size: 0.9rem;
        }
        .member-card .highlight-low {
            color: #dc3545; /* Îπ®Í∞ï (ÎÇ®ÏùÄ ÌöüÏàò Î∂ÄÏ°± Í∞ïÏ°∞) */
            font-weight: bold;
        }
    </style>
</head>

<main layout:fragment="content">
    <div class="container">
        <h4 class="fw-bold mb-4">
            <i class="bi bi-person-badge-fill text-primary me-2"></i> Í∞ïÏÇ¨ Í¥ÄÎ¶¨
        </h4>

        <!-- ‚úÖ Í∞ïÏÇ¨ Î™©Î°ù -->
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 mb-4">
                <div class="card shadow-sm border border-secondary">
                    <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold">
            <i class="bi bi-people-fill me-2 text-secondary"></i> Í∞ïÏÇ¨ Î™©Î°ù
          </span>
                        <a th:href="@{/trainer/register}" class="btn btn-sm btn-primary">
                            <i class="bi bi-plus-lg me-1"></i> Í∞ïÏÇ¨ Îì±Î°ù
                        </a>
                    </div>

                    <div class="card-body scroll-table">
                        <!-- üñ•Ô∏è Îç∞Ïä§ÌÅ¨ÌÉë ÌÖåÏù¥Î∏î -->
                        <table class="table table-striped table-hover text-center align-middle table-desktop">
                            <thead class="table-light">
                            <tr>
                                <th>Ïù¥Î¶Ñ</th>
                                <th>Ïó∞ÎùΩÏ≤ò</th>
                                <th>ÏÑ±Î≥Ñ</th>
                                <th>ÏÉùÎÖÑÏõîÏùº</th>
                                <th>Ïù¥Î©îÏùº</th>
                                <th>Í≤ΩÎ†•</th>
                                <th>ÏàòÎãπ</th>
                                <th>ÏõîÍ∏â</th>
                                <th>Í¥ÄÎ¶¨</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="pt : ${trainers}"
                                th:attr="data-href=@{'/trainer/' + ${pt.trainerId}}"
                                th:classappend="${selectedTrainerId == pt.trainerId} ? 'table-primary'"
                                class="clickable-row">
                                <td><i class="bi bi-person-circle text-primary me-1"></i><span th:text="${pt.name}"></span></td>
                                <td th:text="${pt.phone}"></td>
                                <td th:text="${pt.gender}"></td>
                                <td th:text="${#temporals.format(pt.birthDate, 'yyyy-MM-dd')}"></td>
                                <td th:text="${pt.email}"></td>
                                <td><i class="bi bi-award text-warning me-1"></i><span th:text="${pt.careerYears} + 'ÎÖÑ'"></span></td>
                                <td class="fw-bold text-primary" th:text="${#numbers.formatInteger(pt.payPerSession, 0, 'COMMA')}"></td>
                                <td class="fw-bold text-primary" th:text="${#numbers.formatInteger(pt.baseSalary, 0, 'COMMA')}"></td>
                                <td>
                                    <a th:href="@{'/trainer/' + ${pt.trainerId} + '/edit'}" class="btn btn-sm btn-outline-secondary">ÏàòÏ†ï</a>
                                    <form th:action="@{'/trainer/' + ${pt.trainerId} + '/delete'}" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-outline-danger"
                                                onclick="return confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')">ÏÇ≠Ï†ú</button>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                        <!-- üì± Î™®Î∞îÏùº Ïπ¥Îìú -->
                        <div class="card-mobile">
                            <div th:each="pt : ${trainers}"
                                 class="card mb-3 shadow-sm border border-secondary trainer-card clickable-row"
                                 th:attr="data-href=@{'/trainer/' + ${pt.trainerId}}">

                                <div class="card-body py-3 px-3">
                                    <h5 class="fw-bold mb-2">
                                        <i class="bi bi-person-circle text-primary me-2"></i>
                                        <span th:text="${pt.name}"></span>
                                    </h5>
                                    <p><i class="bi bi-telephone me-2"></i><span th:text="${pt.phone}"></span></p>
                                    <p><i class="bi bi-envelope me-2"></i><span th:text="${pt.email}"></span></p>
                                    <p><i class="bi bi-award me-2"></i>Í≤ΩÎ†• <span th:text="${pt.careerYears}"></span>ÎÖÑ</p>
                                    <p class="fw-bold text-primary"><i class="bi bi-cash-coin me-2"></i>ÏàòÎãπ: <span th:text="${#numbers.formatInteger(pt.payPerSession,0,'COMMA')}"></span></p>
                                    <p class="fw-bold text-primary"><i class="bi bi-cash-stack me-2"></i>ÏõîÍ∏â: <span th:text="${#numbers.formatInteger(pt.baseSalary,0,'COMMA')}"></span></p>

                                    <div class="mt-3 d-flex justify-content-end gap-2">
                                        <a th:href="@{'/trainer/' + ${pt.trainerId} + '/edit'}" class="btn btn-sm btn-outline-secondary">ÏàòÏ†ï</a>
                                        <form th:action="@{'/trainer/' + ${pt.trainerId} + '/delete'}" method="post">
                                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                                    onclick="return confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')">ÏÇ≠Ï†ú</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- card-mobile -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚úÖ Í∞ïÏÇ¨Î≥Ñ ÌöåÏõê Î™©Î°ù -->
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <div class="card shadow-sm">
                    <div class="card-header fw-bold">
                        <i class="bi bi-people-fill me-2 text-secondary"></i>
                        <span th:if="${selectedTrainerId != null}">Í∞ïÏÇ¨ ÌöåÏõê Î™©Î°ù</span>
                        <span th:if="${selectedTrainerId == null}" class="text-muted">Í∞ïÏÇ¨Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</span>
                    </div>

                    <form th:action="@{/trainer/change}" method="post">
                        <div class="card-body scroll-table">

                            <!-- üñ•Ô∏è Îç∞Ïä§ÌÅ¨ÌÉë ÌÖåÏù¥Î∏î -->
                            <table class="table table-striped table-hover text-center align-middle table-desktop"
                                   th:if="${ptMembers != null and !ptMembers.isEmpty()}">
                                <thead class="table-light">
                                <tr>
                                    <th><input type="checkbox" id="selectAll" onclick="toggleAll(this)"/></th>
                                    <th>Ïù¥Î¶Ñ</th>
                                    <th>Ïó∞ÎùΩÏ≤ò</th>
                                    <th>ÏÉùÎÖÑÏõîÏùº</th>
                                    <th>ÏÇ¨Ïö© ÌöüÏàò</th>
                                    <th>ÎÇ®Îäî ÌöüÏàò</th>
                                    <th>ÏãúÏûëÏùº</th>
                                    <th>Ï¢ÖÎ£åÏùº</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="pm : ${ptMembers}">
                                    <td><input name="selectedMemberIds" th:value="${pm.memberId}" type="checkbox"/></td>
                                    <td th:text="${pm.name}"></td>
                                    <td th:text="${pm.phone}"></td>
                                    <td th:text="${#temporals.format(pm.birth, 'yyyy-MM-dd')}"></td>
                                    <td th:text="${pm.remainingCount}"></td>
                                    <td th:classappend="${pm.remainingCount < 3} ? 'highlight-low'"
                                        th:text="${pm.totalCount}"></td>
                                    <td th:text="${#temporals.format(pm.startDate, 'yyyy-MM-dd')}"></td>
                                    <td th:text="${#temporals.format(pm.endDate, 'yyyy-MM-dd')}"></td>
                                </tr>
                                </tbody>
                            </table>

                            <!-- üì± Î™®Î∞îÏùº Ïπ¥Îìú -->
                            <div class="card-mobile" th:if="${ptMembers != null and !ptMembers.isEmpty()}">
                                <div th:each="pm : ${ptMembers}" class="card mb-3 shadow-sm member-card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h6 class="fw-bold mb-2" th:text="${pm.name}">ÌöåÏõêÎ™Ö</h6>
                                            <input name="selectedMemberIds" th:value="${pm.memberId}" type="checkbox"/>
                                        </div>
                                        <p><i class="bi bi-telephone me-2"></i><span th:text="${pm.phone}"></span></p>
                                        <p><i class="bi bi-calendar me-2"></i><span th:text="${#temporals.format(pm.birth, 'yyyy-MM-dd')}"></span></p>
                                        <p><i class="bi bi-bar-chart me-2"></i>ÏÇ¨Ïö©: <span th:text="${pm.remainingCount}"></span></p>
                                        <p><i class="bi bi-box-seam me-2"></i>ÎÇ®Ïùå: <span th:classappend="${pm.remainingCount < 3} ? 'highlight-low'" th:text="${pm.totalCount}"></span></p>
                                        <p><i class="bi bi-calendar-plus me-2"></i>ÏãúÏûë: <span th:text="${#temporals.format(pm.startDate, 'yyyy-MM-dd')}"></span></p>
                                        <p><i class="bi bi-calendar-x me-2"></i>Ï¢ÖÎ£å: <span th:text="${#temporals.format(pm.endDate, 'yyyy-MM-dd')}"></span></p>
                                    </div>
                                </div>
                            </div>

                            <!-- ‚ùå Îç∞Ïù¥ÌÑ∞ ÏóÜÏùÑ Îïå -->
                            <p class="text-muted" th:if="${ptMembers == null or ptMembers.isEmpty()}">Îì±Î°ùÎêú ÌöåÏõêÏù¥ ÏóÜÏäµÎãàÎã§.</p>
                        </div>

                        <!-- ‚úÖ ÏùºÍ¥Ñ Ìä∏Î†àÏù¥ÎÑà Î≥ÄÍ≤Ω -->
                        <div class="card-footer d-flex justify-content-end align-items-center gap-2"
                             th:if="${ptMembers != null and !ptMembers.isEmpty()}">
                            <label>
                                <select name="newTrainerId" class="form-select w-auto">
                                    <option value="">Ìä∏Î†àÏù¥ÎÑà ÏÑ†ÌÉù</option>
                                    <option th:each="t : ${trainers}" th:value="${t.trainerId}" th:text="${t.name}"></option>
                                </select>
                            </label>
                            <button type="submit" class="btn btn-outline-primary"
                                    onclick="return confirm('ÏÑ†ÌÉùÎêú ÌöåÏõêÎì§Ïùò Ìä∏Î†àÏù¥ÎÑàÎ•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?')">
                                Ìä∏Î†àÏù¥ÎÑà Î≥ÄÍ≤Ω
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- ‚úÖ Ìñâ ÌÅ¥Î¶≠ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script>
        function toggleAll(masterCheckbox) {
            document.querySelectorAll("input[name='selectedMemberIds']").forEach(cb => {
                cb.checked = masterCheckbox.checked;
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".clickable-row").forEach(function (row) {
                row.addEventListener("click", function (e) {
                    if (e.target.closest('a') || e.target.closest('button')) return;
                    window.location = this.dataset.href;
                });
            });
        });
    </script>
</main>
</html>
